{
	"info": {
		"_postman_id": "b1b2c3d4-e5f6-4a7b-8c9d-0e1f2a3b4c5e",
		"name": "LMS Backend (Full)",
		"description": "# How to Test Your LMS Routes\n\nThis guide will walk you through importing and using this collection to test your backend.\n\n### Step 1: Check Variables\n\nThis collection uses variables. Click the collection name (\"LMS Backend (Full)\") and go to the **Variables** tab.\n\n* `baseUrl_auth`: Set to `http://localhost:5000/api/auth`\n* `baseUrl_student`: Set to `http://localhost:5000/api/student`\n* `authToken`: This will be filled in *automatically* when you log in.\n\n### Step 2: Test Workflow\n\n**Important:** Make sure your backend server is running! (`npm run dev`)\n\n1.  **Go to the \"Auth\" folder.**\n2.  Run **`POST /register`** to create a new user. Make sure to set the `role` to `\"student\"` in the request body.\n3.  Run **`POST /login`** with the same credentials.\n    * If successful, the **Tests** script will automatically save your JWT to the `authToken` variable.\n\n4.  **Go to the \"Student\" folder.**\n5.  You can now run any of the **`GET`** requests (e.g., `GET /my-profile`). They are all pre-configured to use the `authToken` for authorization.\n\n6.  **To test file upload:**\n    * Run `GET /my-assignments` to find an `_id` for an assignment.\n    * Go to **`POST /submit-assignment`**. In the URL, replace `:assignmentId` with the ID you copied.\n    * Go to the **Body** tab (set to `form-data`).\n    * In the `file` key, click `Select Files` and upload a test file (e.g., a PDF or .txt).\n    * Click **Send**.",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "Auth",
			"description": "User registration and login.",
			"item": [
				{
					"name": "Register User",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"name\": \"Test Student\",\n    \"email\": \"student@example.com\",\n    \"password\": \"password123\",\n    \"role\": \"student\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl_auth}}/register",
							"host": [
								"{{baseUrl_auth}}"
							],
							"path": [
								"register"
							]
						},
						"description": "Registers a new user (admin, teacher, or student).\n\n**Body Fields:**\n* `name` (String)\n* `email` (String)\n* `password` (String)\n* `role` (String: 'admin', 'teacher', or 'student')"
					},
					"response": []
				},
				{
					"name": "Login User",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "raw",
							"raw": "{\n    \"email\": \"student@example.com\",\n    \"password\": \"password123\"\n}",
							"options": {
								"raw": {
									"language": "json"
								}
							}
						},
						"url": {
							"raw": "{{baseUrl_auth}}/login",
							"host": [
								"{{baseUrl_auth}}"
							],
							"path": [
								"login"
							]
						},
						"description": "Logs in an existing user with email and password.\n\nReturns a `token` and `role` if successful."
					},
					"response": []
				}
			]
		},
		{
			"name": "Student",
			"description": "Routes for the logged-in student.",
			"item": [
				{
					"name": "Get My Profile",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl_student}}/my-profile",
							"host": [
								"{{baseUrl_student}}"
							],
							"path": [
								"my-profile"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get My Class",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl_student}}/my-class",
							"host": [
								"{{baseUrl_student}}"
							],
							"path": [
								"my-class"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get My Course",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl_student}}/my-course",
							"host": [
								"{{baseUrl_student}}"
							],
							"path": [
								"my-course"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get My Lessons",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl_student}}/my-lessons",
							"host": [
								"{{baseUrl_student}}"
							],
							"path": [
								"my-lessons"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get My Attendance",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl_student}}/my-attendance",
							"host": [
								"{{baseUrl_student}}"
							],
							"path": [
								"my-attendance"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get My Assignments",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl_student}}/my-assignments",
							"host": [
								"{{baseUrl_student}}"
							],
							"path": [
								"my-assignments"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get My Results",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl_student}}/my-results",
							"host": [
								"{{baseUrl_student}}"
							],
							"path": [
								"my-results"
							]
						}
					},
					"response": []
				},
				{
					"name": "Get My Fees",
					"request": {
						"method": "GET",
						"header": [],
						"url": {
							"raw": "{{baseUrl_student}}/my-fees",
							"host": [
								"{{baseUrl_student}}"
							],
							"path": [
								"my-fees"
							]
						}
					},
					"response": []
				},
				{
					"name": "Submit Assignment",
					"request": {
						"method": "POST",
						"header": [],
						"body": {
							"mode": "formdata",
							"formdata": [
								{
									"key": "file",
									"type": "file",
									"src": []
								}
							]
						},
						"url": {
							"raw": "{{baseUrl_student}}/submit-assignment/:assignmentId",
							"host": [
								"{{baseUrl_student}}"
							],
							"path": [
								"submit-assignment",
								":assignmentId"
							],
							"variable": [
								{
									"key": "assignmentId",
									"value": "REPLACE_WITH_ASSIGNMENT_ID"
								}
							]
						},
						"description": "Submits a file for an assignment. \n\n1. Get an assignment ID from `GET /my-assignments`.\n2. Replace `:assignmentId` in the URL with the real ID.\n3. In the Body (form-data), upload a file under the `file` key."
					},
					"response": []
				}
			]
		}
	],
	"auth": {
		"type": "bearer",
		"bearer": [
			{
				"key": "token",
				"value": "{{authToken}}",
				"type": "string"
			}
		]
	},
	"event": [
		{
			"listen": "prerequest",
			"script": {
				"type": "text/javascript",
				"exec": [
					""
				]
			}
		},
		{
			"listen": "test",
			"script": {
				"type": "text/javascript",
				"exec": [
					"// Collection-level Tests: Safe token/role capture without failing unrelated requests",
					"",
					"// 1) Attempt to parse response as JSON",
					"let json = null;",
					"try {",
					"  json = pm.response.json();",
					"} catch (e) {",
					"  // Not JSON; that's OK for unrelated requests",
					"  json = null;",
					"}",
					"",
					"// 2) Extract token and validate JWT shape",
					"const token = json && json.token;",
					"const jwtRegex = /^[A-Za-z0-9_-]+\\.[A-Za-z0-9_-]+\\.[A-Za-z0-9_-]+$/;",
					"",
					"// 3) Only update variables when token looks like a JWT",
					"if (typeof token === \"string\" && token && jwtRegex.test(token)) {",
					"  pm.collectionVariables.set(\"authToken\", token);",
					"",
					"  if (json && typeof json.role !== \"undefined\") {",
					"    pm.collectionVariables.set(\"userRole\", String(json.role));",
					"  }",
					"",
					"  console.info(\"[Auth] Captured valid JWT token and updated variables.\");",
					"} else {",
					"  // Do not overwrite existing variables when token missing/invalid",
					"  if (token) {",
					"    console.warn(\"[Auth] Token present but not a valid-looking JWT. Variables not modified.\");",
					"  } else {",
					"    console.debug(\"[Auth] No token in response. Variables not modified.\");",
"  }",
					"}"
				]
			}
		}
	],
	"variable": [
		{
			"key": "baseUrl_auth",
			"value": "http://localhost:5000/api/auth",
			"description": "Base URL for Auth routes"
		},
		{
			"key": "baseUrl_student",
			"value": "http://localhost:5000/api/student",
			"description": "Base URL for Student routes"
		},
		{
			"key": "authToken",
			"value": "",
			"description": "Auto-populated from Login request"
		},
		{
			"key": "userRole",
			"value": "",
			"description": "Auto-populated from Login request"
		}
	]
}